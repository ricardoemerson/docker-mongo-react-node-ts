version: "3"

services:
    database:
        container_name: "mongodb"
        image: "mongo"
        environment:
            - MONGO_INITDB_DATABASE=${MONGO_INITDB_DATABASE}
            - MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
            - MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
        ports:
            - 27017-27017
        volumes:
            - ./data:/data/db
    server:
        build:
            context: ./packages/server
            args:
                NODE_ENV: development
        container_name: "server"
        expose:
            - ${SERVER_PORT}
        ports:
            - ${SERVER_PORT}:${SERVER_PORT}
        volumes:
            - ./packages/server/src:/server/src
            - ./packages/server/node_modules:/server/node_modules
        links:
            - database
        command: yarn dev
    web:
        build: ./packages/web
        container_name: "web"
        expose:
            - ${APP_PORT}
        ports:
            - ${APP_PORT}:${APP_PORT}
        volumes:
            - ./packages/web/node_modules:/web/node_modules
        links:
            - server
